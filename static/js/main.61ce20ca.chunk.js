(this["webpackJsonpplanning-poker"]=this["webpackJsonpplanning-poker"]||[]).push([[0],{40:function(e,t,n){},41:function(e,t,n){},59:function(e,t,n){},60:function(e,t,n){"use strict";n.r(t);var c=n(2),a=n(1),o=n.n(a),r=n(31),i=n.n(r),s=(n(40),n(5)),l=n(15),u=n(6),d=(n(41),n(32)),b=n.n(d),j=n(8),m=function e(t){Object(j.a)(this,e),this.name=t,this.flipped=!1,this.value=""},p=n(13),f=n(25),h=function e(t,n,c){Object(j.a)(this,e),this.name=t,this.flipped=!1,this.players=void 0,this.players=Object(p.a)({},n,new m(c))};var O=n(22);n(51);O.a.apps.length||O.a.initializeApp({apiKey:"AIzaSyCbCXKvaOhPnqcgEjhESuo9IjCLbvyx8GA",authDomain:"testing-7bdba.firebaseapp.com",databaseURL:"https://testing-7bdba.firebaseio.com",projectId:"testing-7bdba",storageBucket:"testing-7bdba.appspot.com",messagingSenderId:"123433442681",appId:"1:123433442681:web:e2576007bf4485162ca3a8"});var v=O.a.database().ref().child("planning-poker-v2"),x=n(26),g=n(62),y=n(14),N=new(function(){function e(t){Object(j.a)(this,e),this.APP_NAME=t}return Object(y.a)(e,[{key:"setAppStorage",value:function(e,t){return localStorage.setItem(this.getKey(e),JSON.stringify(t)),t}},{key:"getAppStorage",value:function(e){var t=localStorage.getItem(this.getKey(e));return t&&JSON.parse(t)}},{key:"getKey",value:function(e){return"".concat(this.APP_NAME,".").concat(e)}}]),e}())("PLANNING_POKER"),S="deviceData",R=[];function w(){return N.getAppStorage(S)}function C(e){var t=N.setAppStorage(S,e);return R.forEach((function(e){return e(t)})),t}var D={getDeviceData:w,setDeviceData:C,onChange:function(e){R.push(e)},setName:function(e){C(Object(x.a)(Object(x.a)({},w()),{},{name:e,userId:"".concat(Object(g.a)(),"_").concat(e)}))}},P=v.child("rooms");var I={createRoom:function(e){return P.once("value").then((function(t){var n=t.val()||{},c=b.a.generate();if(c in n)throw new Error("couldnt create new room b/c of id collision");var a=D.getDeviceData();if(!a)throw new Error("deviceData not defined");return new Promise((function(t,n){P.child(c).set(new h(e,a.userId,a.name),(function(e){e?n(e):t(c)}))}))}))},onRoomUpdate:function(e,t){P.child(e).on("value",(function(e){return t(e.val())}))},addRoomPlayer:function(e,t,n){P.child(e).child("players").child(t).set(new m(n))},removeRoomPlayer:function(e,t){P.child(e).child("players").child(t).remove()},updateRoomPlayer:function(e,t,n){P.child(e).child("players").child(t).update(n)},flipAllRoomCards:function(e,t){var n=t.players;Object.entries(n).forEach((function(e){var t=Object(s.a)(e,2),n=(t[0],t[1]);n.value&&(n.flipped=!0)})),P.child(e).child("players").update(n)},resetAllRoomCards:function(e,t){var n=t.players;Object.entries(n).forEach((function(e){var t=Object(s.a)(e,2),n=(t[0],t[1]);n.value="",n.flipped=!1})),P.child(e).child("players").update(n)}},E=function(){var e=Object(a.useState)(""),t=Object(s.a)(e,2),n=t[0],o=t[1],r=Object(a.useState)(""),i=Object(s.a)(r,2),l=i[0],d=i[1],b=Object(u.f)();function j(e){b.push("/rooms/".concat(e))}return Object(c.jsxs)("div",{children:[Object(c.jsxs)("form",{onSubmit:function(e){e.preventDefault(),l&&j(l)},children:[Object(c.jsx)("label",{htmlFor:"roomCode",children:"Join Room:"}),Object(c.jsxs)("div",{className:"input-group mb-3",children:[Object(c.jsx)("input",{id:"roomCode",type:"text",className:"form-control",placeholder:"Room Code","aria-label":"Room Code",onChange:function(e){return d(e.target.value)}}),Object(c.jsx)("div",{className:"input-group-append",children:Object(c.jsx)("button",{className:"btn btn-outline-primary",type:"submit",id:"joinRoomButton",children:"Join Room"})})]})]}),Object(c.jsxs)("form",{onSubmit:function(e){e.preventDefault(),n&&I.createRoom(n).then((function(e){j(e)})).catch((function(e){console.log("err =",e)}))},children:[Object(c.jsx)("label",{htmlFor:"roomName",children:"Create Room:"}),Object(c.jsxs)("div",{className:"input-group mb-3",children:[Object(c.jsx)("input",{id:"roomName",type:"text",className:"form-control",placeholder:"Room Name","aria-label":"Room Name",onChange:function(e){return o(e.target.value)}}),Object(c.jsx)("div",{className:"input-group-append",children:Object(c.jsx)("button",{id:"createRoomButton",className:"btn btn-outline-secondary",type:"submit",children:"Create Room"})})]})]})]})},k=function(e){var t=e.deviceData,n=e.children,o=Object(a.useState)(!1),r=Object(s.a)(o,2),i=r[0],l=r[1],u=Object(a.useRef)(null);return Object(a.useEffect)((function(){function e(e){e.target!==u.current&&l(!1)}return window.addEventListener("click",e),function(){window.removeEventListener("click",e)}}),[]),Object(c.jsx)("div",{className:"btn-group",children:Object(c.jsxs)("div",{className:"dropdown",children:[Object(c.jsxs)("button",{ref:u,className:"btn btn-outline-secondary dropdown-toggle",type:"button",id:"profileMenuButton","aria-label":"Profile Options","data-bs-toggle":"dropdown","aria-expanded":i,onClick:function(){return l(!i)},children:["Hello ",t.name,"!"]}),Object(c.jsx)("ul",{className:"dropdown-menu ".concat(i?"show":""),style:{right:0,left:"auto"},"aria-labelledby":"profileMenuButton",children:n})]})})},A=function(e){var t=e.deviceData,n=Object(u.f)();return Object(c.jsx)("nav",{className:"navbar navbar-light bg-light",children:Object(c.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",width:"100%"},children:[Object(c.jsx)(l.b,{className:"navbar-brand",to:"/",children:"Planning Poker"}),t&&Object(c.jsx)(k,{deviceData:t,children:Object(c.jsx)("li",{children:Object(c.jsx)("button",{className:"dropdown-item",onClick:function(){D.setDeviceData(null),n.push("/")},children:"Logout"})})})]})})},L=function(e){var t=e.onSubmit,n=Object(a.useState)(""),o=Object(s.a)(n,2),r=o[0],i=o[1];return Object(c.jsxs)("div",{children:[Object(c.jsx)("div",{children:"Please enter your name:"}),Object(c.jsx)("form",{onSubmit:function(e){e.preventDefault(),""!==r&&t(r)},children:Object(c.jsxs)("div",{className:"form-row",children:[Object(c.jsx)("div",{className:"col",children:Object(c.jsx)("input",{type:"text",placeholder:"Name",id:"name",className:"form-control",value:r,onChange:function(e){i(e.target.value)}})}),Object(c.jsx)("div",{className:"col-auto",children:Object(c.jsx)("button",{type:"submit",className:"btn btn-primary",children:"Submit"})})]})})]})};n(59);var F=n(34);var B=function(e){var t,n,o=e.userId,r=e.player,i=e.onRemovePlayer,l=e.currentUser,u=Object(a.useState)(!1),d=Object(s.a)(u,2),b=d[0],j=d[1];return Object(a.useEffect)((function(){r.value&&j(!0);var e=setTimeout((function(){j(!1)}),1e3);return function(){clearTimeout(e)}}),[r.value]),Object(c.jsx)("div",{className:"col-6 col-sm-4 col-md-3 mb-3",children:Object(c.jsxs)("div",{className:"player-tile ".concat(l===o?"me":""),children:[Object(c.jsx)("div",{className:"player-remove",onClick:function(){return i(o)},children:"\u2715"}),Object(c.jsxs)("div",{className:"player-name",children:[Object(c.jsx)("div",{children:r.name}),Object(c.jsx)("small",{children:l===o?"(you)":""})]}),Object(c.jsx)(F.a.div,{className:"player-card ".concat(b?"pulse":""," ").concat((t=r.flipped,n=r.value,n?t?"flipped":"ready":"empty")),children:Object(c.jsx)("div",{children:r.flipped?r.value:""})})]})})},M=["?","0","0.5","1","2","3","5","8","13","21"],J=function(e){var t=e.onSubmit,n=e.onExit,o=Object(a.useState)(""),r=Object(s.a)(o,2),i=r[0],l=r[1];return Object(c.jsx)("div",{className:"mb-3",children:Object(c.jsx)("form",{onSubmit:function(e){e.preventDefault(),""!==i&&t(i)},children:Object(c.jsxs)("div",{className:"form-row",children:[Object(c.jsx)("div",{className:"col-auto",children:Object(c.jsx)("button",{type:"button",className:"btn btn-danger",onClick:n,children:"Exit Room"})}),Object(c.jsx)("div",{className:"col",children:Object(c.jsxs)("select",{id:"points",className:"form-control",onChange:function(e){l(e.target.value)},children:[Object(c.jsx)("option",{value:"",children:"Pick your points"}),M.map((function(e){return Object(c.jsx)("option",{value:e,children:e},e)}))]})}),Object(c.jsx)("div",{className:"col-auto",children:Object(c.jsx)("button",{type:"submit",className:"btn btn-primary",children:"Submit"})})]})})})},K=function(e){var t=e.roomId,n=e.room,o=e.deviceData,r=Object(u.f)();function i(e){I.removeRoomPlayer(t,e)}Object(a.useEffect)((function(){I.addRoomPlayer(t,o.userId,o.name)}),[t,o]);var l=Object.entries(n.players).sort((function(e,t){var n=Object(s.a)(e,1)[0];Object(s.a)(t,1)[0];return n===o.userId?-1:1})),d=function(e){var t=Object.entries(e).map((function(e){var t=Object(s.a)(e,2);return t[0],t[1]})).filter((function(e){return e.flipped})).map((function(e){return Number(e.value)}));return 0===t.length?"":f.mode(t).toString()}(n.players),b=function(e){var t=Object.entries(e).map((function(e){var t=Object(s.a)(e,2);return t[0],t[1]})).filter((function(e){return e.flipped})).map((function(e){return Number(e.value)}));return 0===t.length?"":f.mean(t).toString()}(n.players);return Object(c.jsxs)("div",{children:[Object(c.jsxs)("div",{children:[Object(c.jsx)("strong",{children:"You're in room:"})," ",n.name]}),Object(c.jsxs)("div",{className:"mb-2",children:[Object(c.jsx)("strong",{children:"Room code:"})," ",t]}),Object(c.jsx)("div",{className:"mb-2",children:Object(c.jsx)(J,{onSubmit:function(e){I.updateRoomPlayer(t,o.userId,{value:e,flipped:!1})},onExit:function(){r.push("/")}})}),Object(c.jsxs)("div",{className:"mb-3 text-center",children:[Object(c.jsx)("button",{type:"button",className:"btn btn-success mr-3",onClick:function(){I.flipAllRoomCards(t,n)},children:"Flip all cards"}),Object(c.jsx)("button",{type:"button",className:"btn btn-secondary",onClick:function(){I.resetAllRoomCards(t,n)},children:"Reset"})]}),Object(c.jsxs)("div",{className:"text-center mb-3",children:["Mode: ",d," | Mean : ",b]}),Object(c.jsx)("div",{className:"row",children:l.map((function(e){var t=Object(s.a)(e,2),n=t[0],a=t[1];return Object(c.jsx)(B,{userId:n,currentUser:o.userId,player:a,onRemovePlayer:i},n)}))})]})},U=function(e){var t=e.deviceData,n=Object(u.g)().roomId,o=Object(a.useState)(null),r=Object(s.a)(o,2),i=r[0],l=r[1],d=Object(a.useState)(!0),b=Object(s.a)(d,2),j=b[0],m=b[1],p=Object(a.useState)(!1),f=Object(s.a)(p,2),h=f[0],O=f[1];return Object(a.useEffect)((function(){m(!0),I.onRoomUpdate(n,(function(e){m(!1),console.log("newRoomData =",e),e?(O(!1),l(e)):O(!0)}))}),[n]),j?Object(c.jsx)("div",{children:"Loading..."}):h||!i?Object(c.jsx)("div",{children:"Room Not Found"}):Object(c.jsx)(K,{roomId:n,room:i,deviceData:t})};var T=function(){var e=function(){var e=Object(a.useState)(D.getDeviceData()),t=Object(s.a)(e,2),n=t[0],c=t[1];return Object(a.useEffect)((function(){D.onChange((function(e){c(e)}))}),[]),[n,function(e){D.setName(e)}]}(),t=Object(s.a)(e,2),n=t[0],o=t[1];return Object(c.jsxs)(l.a,{children:[Object(c.jsx)(A,{deviceData:n}),Object(c.jsx)("div",{className:"container mt-3 mb-3",children:n?Object(c.jsxs)(u.c,{children:[Object(c.jsx)(u.a,{exact:!0,path:"/",children:Object(c.jsx)(E,{})}),Object(c.jsx)(u.a,{path:"/rooms/:roomId",children:Object(c.jsx)(U,{deviceData:n})})]}):Object(c.jsx)(L,{onSubmit:o})})]})},_=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,63)).then((function(t){var n=t.getCLS,c=t.getFID,a=t.getFCP,o=t.getLCP,r=t.getTTFB;n(e),c(e),a(e),o(e),r(e)}))};i.a.render(Object(c.jsx)(o.a.StrictMode,{children:Object(c.jsx)(T,{})}),document.getElementById("root")),_()}},[[60,1,2]]]);
//# sourceMappingURL=main.61ce20ca.chunk.js.map